<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="User Data Collection Funnel" />
    <meta name="keywords" content="data collection, funnel, registration" />
    <meta name="author" content="TAJBank" />
    <link rel="icon" href="../assets/images/favicon.png" type="image/x-icon" />
    <link rel="shortcut icon" href="../assets/images/favicon.png" type="image/x-icon" />

    <title>TAJBank | User Information Funnel</title>
    <link rel="stylesheet" type="text/css" href="../assets/css/loginthemestyle.css">
    <script src="../js/newjs/kitfontawesome.js"></script>
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/animate.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/animate.css">

    <style>
        .funnel-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .funnel-step {
            display: none;
            animation: slideIn 0.5s ease-in-out;
        }

        .funnel-step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            gap: 10px;
        }

        .progress-step {
            flex: 1;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            position: relative;
        }

        .progress-step.completed {
            background-color: #28a745;
        }

        .progress-step.active {
            background-color: #e41613;
        }

        .step-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .step-description {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .form-field {
            margin-bottom: 20px;
        }

        .form-field label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-field input,
        .form-field select,
        .form-field textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #e41613;
            box-shadow: 0 0 0 2px rgba(228, 22, 19, 0.1);
        }

        .form-field textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .button-group button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-next {
            background-color: #e41613;
            color: white;
        }

        .btn-next:hover {
            background-color: #c41310;
        }

        .btn-prev {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        .btn-prev:hover {
            background-color: #e0e0e0;
        }

        .btn-submit {
            background-color: #28a745;
            color: white;
        }

        .btn-submit:hover {
            background-color: #218838;
        }

        .success-message {
            display: none;
            padding: 20px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            color: #155724;
            text-align: center;
        }

        .error-message {
            color: #dc3545;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"],
        .checkbox-group input[type="radio"] {
            width: auto;
            margin: 0;
            cursor: pointer;
        }

        .card-container {
            background: white;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .simplebar-content {
            padding-bottom: 100px !important
        }

        .nifi-logo {
            position: absolute;
            right: 1%;
            width: 14%;
            max-width: 100%;
            overflow: hidden;
        }

        .funnel-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .funnel-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .funnel-header p {
            color: #666;
            font-size: 14px;
        }
    </style>

</head>

<body>
    <div id="cf3" class="fadein">
        <img class="bottom" src="../assets/images/banner-bg3 1.png">
        <img class="top" src="../assets/images/banner-bg8.jpeg">
        <img class="fadein" src="../assets/images/banner-bg1.jpeg">
    </div>
    <div class="overlay"></div>
    <div class="main1">
        <div class="container-fluid">
            <div class="container">
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-6 col-md-8 col-sm-12">
                        <div class="card-container animate__animated animate__fadeInRight">
                            <div class="funnel-header">
                                <img src="../assets/images/tajbank 1.png" alt="TAJBank" style="margin-bottom: 20px; max-width: 200px;">
                                <h1>Welcome to TAJBank</h1>
                                <p>Help us serve you better by sharing your information</p>
                            </div>

                            <div class="progress-indicator" id="progressIndicator"></div>

                            <form id="funnelForm">

                                <!-- Step 1: Basic Information -->
                                <div class="funnel-step active" data-step="1">
                                    <h3 class="step-title">Tell us about yourself</h3>
                                    <p class="step-description">We'd like to know your basic information</p>

                                    <div class="form-field">
                                        <label for="firstName">First Name *</label>
                                        <input type="text" id="firstName" name="firstName" placeholder="Enter your first name" required>
                                        <span class="error-message" id="firstNameError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="lastName">Last Name *</label>
                                        <input type="text" id="lastName" name="lastName" placeholder="Enter your last name" required>
                                        <span class="error-message" id="lastNameError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                                        <span class="error-message" id="emailError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="phone">Phone Number *</label>
                                        <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                                        <span class="error-message" id="phoneError"></span>
                                    </div>

                                    <div class="button-group">
                                        <button type="button" class="btn-next" onclick="validateAndNextStep(1)">Next</button>
                                    </div>
                                </div>

                                <!-- Step 2: Company Information -->
                                <div class="funnel-step" data-step="2">
                                    <h3 class="step-title">Your Organization</h3>
                                    <p class="step-description">Tell us about your company</p>

                                    <div class="form-field">
                                        <label for="companyName">Company Name *</label>
                                        <input type="text" id="companyName" name="companyName" placeholder="Enter company name" required>
                                        <span class="error-message" id="companyNameError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="industry">Industry *</label>
                                        <select id="industry" name="industry" required>
                                            <option value="">Select your industry</option>
                                            <option value="finance">Finance & Banking</option>
                                            <option value="technology">Technology</option>
                                            <option value="manufacturing">Manufacturing</option>
                                            <option value="retail">Retail & Commerce</option>
                                            <option value="healthcare">Healthcare</option>
                                            <option value="education">Education</option>
                                            <option value="energy">Energy & Utilities</option>
                                            <option value="other">Other</option>
                                        </select>
                                        <span class="error-message" id="industryError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="companySize">Company Size *</label>
                                        <select id="companySize" name="companySize" required>
                                            <option value="">Select company size</option>
                                            <option value="1-50">1 - 50 employees</option>
                                            <option value="51-200">51 - 200 employees</option>
                                            <option value="201-500">201 - 500 employees</option>
                                            <option value="501-1000">501 - 1000 employees</option>
                                            <option value="1000+">1000+ employees</option>
                                        </select>
                                        <span class="error-message" id="companySizeError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="jobTitle">Job Title *</label>
                                        <input type="text" id="jobTitle" name="jobTitle" placeholder="Enter your job title" required>
                                        <span class="error-message" id="jobTitleError"></span>
                                    </div>

                                    <div class="button-group">
                                        <button type="button" class="btn-prev" onclick="previousStep()">Back</button>
                                        <button type="button" class="btn-next" onclick="validateAndNextStep(2)">Next</button>
                                    </div>
                                </div>

                                <!-- Step 3: Business Needs -->
                                <div class="funnel-step" data-step="3">
                                    <h3 class="step-title">What interests you?</h3>
                                    <p class="step-description">Select the services you're interested in</p>

                                    <div class="form-field">
                                        <label>Areas of Interest *</label>
                                        <div class="checkbox-group">
                                            <label>
                                                <input type="checkbox" name="interests" value="payments"> Payment Solutions
                                            </label>
                                            <label>
                                                <input type="checkbox" name="interests" value="lending"> Lending & Credit
                                            </label>
                                            <label>
                                                <input type="checkbox" name="interests" value="investments"> Investment Services
                                            </label>
                                            <label>
                                                <input type="checkbox" name="interests" value="trade"> Trade Finance
                                            </label>
                                            <label>
                                                <input type="checkbox" name="interests" value="treasury"> Treasury Management
                                            </label>
                                            <label>
                                                <input type="checkbox" name="interests" value="consulting"> Consulting Services
                                            </label>
                                        </div>
                                        <span class="error-message" id="interestsError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="timeline">Expected Timeline for Implementation *</label>
                                        <select id="timeline" name="timeline" required>
                                            <option value="">Select timeline</option>
                                            <option value="immediate">Immediate (0-3 months)</option>
                                            <option value="soon">Soon (3-6 months)</option>
                                            <option value="planning">Still Planning (6-12 months)</option>
                                            <option value="exploring">Just Exploring</option>
                                        </select>
                                        <span class="error-message" id="timelineError"></span>
                                    </div>

                                    <div class="button-group">
                                        <button type="button" class="btn-prev" onclick="previousStep()">Back</button>
                                        <button type="button" class="btn-next" onclick="validateAndNextStep(3)">Next</button>
                                    </div>
                                </div>

                                <!-- Step 4: Additional Information -->
                                <div class="funnel-step" data-step="4">
                                    <h3 class="step-title">Final Details</h3>
                                    <p class="step-description">Help us personalize your experience</p>

                                    <div class="form-field">
                                        <label for="budget">Estimated Budget *</label>
                                        <select id="budget" name="budget" required>
                                            <option value="">Select budget range</option>
                                            <option value="under-100k">Under $100,000</option>
                                            <option value="100k-500k">$100,000 - $500,000</option>
                                            <option value="500k-1m">$500,000 - $1,000,000</option>
                                            <option value="1m-5m">$1,000,000 - $5,000,000</option>
                                            <option value="5m+">Over $5,000,000</option>
                                        </select>
                                        <span class="error-message" id="budgetError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label for="message">How can we help you? *</label>
                                        <textarea id="message" name="message" placeholder="Tell us about your specific needs or goals" required></textarea>
                                        <span class="error-message" id="messageError"></span>
                                    </div>

                                    <div class="form-field">
                                        <label>
                                            <input type="checkbox" id="newsletter" name="newsletter" value="yes"> Subscribe to our newsletter for updates and insights
                                        </label>
                                    </div>

                                    <div class="form-field">
                                        <label>
                                            <input type="checkbox" id="terms" name="terms" value="yes" required> I agree to the terms and conditions *
                                        </label>
                                        <span class="error-message" id="termsError"></span>
                                    </div>

                                    <div class="success-message" id="successMessage">
                                        <h4>Thank You!</h4>
                                        <p>Your information has been successfully submitted. We'll be in touch shortly!</p>
                                    </div>

                                    <div class="button-group">
                                        <button type="button" class="btn-prev" onclick="previousStep()">Back</button>
                                        <button type="button" class="btn-submit" onclick="submitForm()">Submit</button>
                                    </div>
                                </div>

                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="../assets/js/jquery-3.5.1.min.js"></script>
        <script src="../assets/js/bootstrap/bootstrap.bundle.min.js"></script>

        <script>
            const totalSteps = 4;
            let currentStep = 1;
            const funnelData = {};

            // Initialize progress indicator
            function initializeProgress() {
                const progressIndicator = document.getElementById('progressIndicator');
                progressIndicator.innerHTML = '';
                for (let i = 1; i <= totalSteps; i++) {
                    const step = document.createElement('div');
                    step.className = 'progress-step';
                    if (i < currentStep) {
                        step.classList.add('completed');
                    } else if (i === currentStep) {
                        step.classList.add('active');
                    }
                    progressIndicator.appendChild(step);
                }
            }

            // Show/hide steps
            function goToStep(stepNum) {
                document.querySelectorAll('.funnel-step').forEach(step => {
                    step.classList.remove('active');
                });
                document.querySelector(`[data-step="${stepNum}"]`).classList.add('active');
                initializeProgress();
                window.scrollTo(0, 0);
            }

            // Validation functions
            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            function validatePhone(phone) {
                const re = /^[+]?[(]?[0-9]{1,4}[)]?[-\s.]?[(]?[0-9]{1,4}[)]?[-\s.]?[0-9]{1,9}$/;
                return re.test(phone.replace(/\s/g, ''));
            }

            function clearErrors() {
                document.querySelectorAll('.error-message').forEach(el => {
                    el.style.display = 'none';
                    el.textContent = '';
                });
            }

            function showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
            }

            // Step validation
            function validateStep1() {
                clearErrors();
                let isValid = true;

                const firstName = document.getElementById('firstName').value.trim();
                if (!firstName) {
                    showError('firstNameError', 'First name is required');
                    isValid = false;
                }

                const lastName = document.getElementById('lastName').value.trim();
                if (!lastName) {
                    showError('lastNameError', 'Last name is required');
                    isValid = false;
                }

                const email = document.getElementById('email').value.trim();
                if (!email) {
                    showError('emailError', 'Email is required');
                    isValid = false;
                } else if (!validateEmail(email)) {
                    showError('emailError', 'Please enter a valid email');
                    isValid = false;
                }

                const phone = document.getElementById('phone').value.trim();
                if (!phone) {
                    showError('phoneError', 'Phone number is required');
                    isValid = false;
                } else if (!validatePhone(phone)) {
                    showError('phoneError', 'Please enter a valid phone number');
                    isValid = false;
                }

                if (isValid) {
                    funnelData.firstName = firstName;
                    funnelData.lastName = lastName;
                    funnelData.email = email;
                    funnelData.phone = phone;
                }

                return isValid;
            }

            function validateStep2() {
                clearErrors();
                let isValid = true;

                const companyName = document.getElementById('companyName').value.trim();
                if (!companyName) {
                    showError('companyNameError', 'Company name is required');
                    isValid = false;
                } else {
                    funnelData.companyName = companyName;
                }

                const industry = document.getElementById('industry').value;
                if (!industry) {
                    showError('industryError', 'Please select an industry');
                    isValid = false;
                } else {
                    funnelData.industry = industry;
                }

                const companySize = document.getElementById('companySize').value;
                if (!companySize) {
                    showError('companySizeError', 'Please select company size');
                    isValid = false;
                } else {
                    funnelData.companySize = companySize;
                }

                const jobTitle = document.getElementById('jobTitle').value.trim();
                if (!jobTitle) {
                    showError('jobTitleError', 'Job title is required');
                    isValid = false;
                } else {
                    funnelData.jobTitle = jobTitle;
                }

                return isValid;
            }

            function validateStep3() {
                clearErrors();
                let isValid = true;

                const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value);
                if (interests.length === 0) {
                    showError('interestsError', 'Please select at least one area of interest');
                    isValid = false;
                } else {
                    funnelData.interests = interests;
                }

                const timeline = document.getElementById('timeline').value;
                if (!timeline) {
                    showError('timelineError', 'Please select a timeline');
                    isValid = false;
                } else {
                    funnelData.timeline = timeline;
                }

                return isValid;
            }

            function validateStep4() {
                clearErrors();
                let isValid = true;

                const budget = document.getElementById('budget').value;
                if (!budget) {
                    showError('budgetError', 'Please select a budget range');
                    isValid = false;
                } else {
                    funnelData.budget = budget;
                }

                const message = document.getElementById('message').value.trim();
                if (!message) {
                    showError('messageError', 'Please tell us how we can help');
                    isValid = false;
                } else {
                    funnelData.message = message;
                }

                const terms = document.getElementById('terms').checked;
                if (!terms) {
                    showError('termsError', 'You must agree to the terms and conditions');
                    isValid = false;
                }

                funnelData.newsletter = document.getElementById('newsletter').checked ? 'yes' : 'no';

                return isValid;
            }

            function validateAndNextStep(step) {
                let isValid = false;
                switch(step) {
                    case 1:
                        isValid = validateStep1();
                        break;
                    case 2:
                        isValid = validateStep2();
                        break;
                    case 3:
                        isValid = validateStep3();
                        break;
                }

                if (isValid && step < totalSteps) {
                    currentStep = step + 1;
                    goToStep(currentStep);
                }
            }

            function previousStep() {
                if (currentStep > 1) {
                    currentStep--;
                    goToStep(currentStep);
                }
            }

            function submitForm() {
                if (validateStep4()) {
                    // Prepare data for submission
                    const formData = new FormData();
                    Object.keys(funnelData).forEach(key => {
                        if (Array.isArray(funnelData[key])) {
                            funnelData[key].forEach(value => {
                                formData.append(key, value);
                            });
                        } else {
                            formData.append(key, funnelData[key]);
                        }
                    });
                    formData.append('submittedAt', new Date().toISOString());

                    // Send to server
                    $.ajax({
                        url: '/Account/SubmitUserDataFunnel',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                // Hide form and show success message
                                document.getElementById('funnelForm').style.display = 'none';
                                document.getElementById('successMessage').style.display = 'block';
                                
                                // Log collected data
                                console.log('Funnel data collected:', funnelData);

                                // Optionally redirect after a delay
                                setTimeout(function() {
                                    window.location.href = '/home/index';
                                }, 3000);
                            } else {
                                alert('Error submitting form. Please try again.');
                            }
                        },
                        error: function(error) {
                            console.error('Submission error:', error);
                            alert('Error submitting form. Please check your connection and try again.');
                        }
                    });
                }
            }

            // Initialize on load
            document.addEventListener('DOMContentLoaded', function() {
                initializeProgress();
            });

            // Log funnel progression for analytics
            function logFunnelEvent(eventName, data) {
                console.log(`Funnel Event: ${eventName}`, data);
                // Can be sent to analytics service
            }

            // Track when users move between steps
            const originalGoToStep = goToStep;
            goToStep = function(stepNum) {
                originalGoToStep(stepNum);
                logFunnelEvent('step_change', {step: stepNum, timestamp: new Date()});
            };
        </script>

    </div>
</body>

</html>
